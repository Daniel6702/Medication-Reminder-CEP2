{% extends 'base_profile.html' %}

{% block profile_content %}

<h1>Configurations</h1>

<hr>

<div>
    <p>Your API Token:</p>
    <textarea id="apiToken" readonly>{{ token.key }}</textarea>
</div>

<hr>

<h3>MQTT Configuration</h3>

<form method="post">
    {% csrf_token %}
    {{ mqtt_form.as_p }}
    <button type="submit">Save Configuration</button>
</form>

<hr>

<h3>Device Configuration</h3>

<!-- Form to add new device -->
<form method="post">
    {% csrf_token %}
    {{ device_form.as_p }}
    <button type="submit" name="device_submit">Add Device</button>
</form>

<!-- List existing devices -->
<div>
    <h4>Your Devices</h4>
    {% if devices %}
        <ul>
            {% for device in devices %}
                <li>| Name: {{ device.name }} | Type: {{ device.type }} | room: {{ device.room }} | uuid: {{ device.device_id}} | zigbee_id: {{ device.zigbee_id}} | status: {{ device.status}} |</li>
                <!-- Add more details as needed -->
            {% endfor %}
        </ul>
    {% else %}
        <p>No devices found.</p>
    {% endif %}
</div>

<hr>

<h3>Room Configuration</h3>

<!-- Form to add new room -->
<form method="post">
    {% csrf_token %}
    {{ room_form.as_p }}
    <button type="submit" name="room_submit">Add Room</button>
</form>

<!-- List existing rooms -->
<div>
    <h4>Your Rooms</h4>
    {% if rooms %}
        <ul>
            {% for room in rooms %}
                <li>{{ room.name }}</li>
                <ul>
                    {% for device in room.devices.all %}
                        <li>{{ device.name }} ({{ device.type }})</li>
                    {% endfor %}
                </ul>
            {% endfor %}
        </ul>
    {% else %}
        <p>No rooms found.</p>
    {% endif %}
</div>

<hr>

<h3>State Configuration</h3>

<form method="get" action="">
    <label for="state">Select State:</label>
    <select name="state" onchange="this.form.submit()">
        {% for state, name in state_names %}
            <option value="{{ state }}" {% if state == current_state %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
    </select>
</form>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ state_config_form.as_p }}
    <input type="hidden" name="state_name" value="{{ current_state }}">
    <button type="submit" name="state_config_submit">Save State Configuration</button>
</form>

{% endblock %}

{% block extra_css %}
{% endblock %}

{% block extra_js %}
{% endblock %}